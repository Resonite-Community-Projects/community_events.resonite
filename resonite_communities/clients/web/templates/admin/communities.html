{% extends "admin/base.html" %}
{% block alpine_components_head %}
    <script src="/static/js/alpine/pages/admin_communities.js"></script>
{% endblock %}
{% block extended_head %}
<style>
    :required,
    .required {
        border-color: red;
    }
</style>
{% endblock %}
{% block content %}

<div x-data="{ ...communityModal(), activeTab: 'events' }">
    <div class="tabs is-centered is-boxed is-medium">
        <ul>
            <li :class="{ 'is-active': activeTab === 'events' }"><a @click="activeTab = 'events'">Event communities</a></li>
            <li :class="{ 'is-active': activeTab === 'streams' }"><a @click="activeTab = 'streams'">Streams communities</a></li>
        </ul>
    </div>

    <div x-show="activeTab === 'events'" style="width: 100%;">

    <button class="button is-success" @click="handleCommunityAction('add', null, 'event')">Add event community</button>

    <div class="grid">
        {% for community in events_communities %}
        <div class="cell">
            <div class="card-image">
                <figure class="image is-96x96">
                    {% if community.logo %}
                    <img src="{{ community.logo }}" alt="Community logo">
                    {% else %}
                    <img src="https://cdn.alicorn.network/resonite-communities.com/community_discord_placeholder.png" alt="Placeholder community logo">
                    {% endif %}
                </figure>
            </div>
            <div class="card">
                <div class="card-header">
                    <p class="card-header-title">{{ community.name }}</p>
                </div>
                <div class="card-content">
                    <div>
                        <button class="button is-warning" @click="handleCommunityAction('edit', '{{ community.id }}', 'event')"><i class="fas fa-pen"></i></button>
                        <button class="button is-danger" @click="handleCommunityAction('delete', '{{ community.id }}', 'event')"><i class="fas fa-trash"></i></button>
                        <button class="button is-link" {% if not community.url %}title="disabled" disabled{% endif %}><i class="fas fa-up-right-from-square"></i></button>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <div x-show="activeTab === 'streams'" style="width: 100%;">

    <button class="button is-success" @click="handleCommunityAction('add', null, 'stream')">Add stream community</button>

    <div class="grid">
        {% for community in streams_communities %}
        <div class="cell">
            <div class="card">
                <div class="card-header">
                    <p class="card-header-title">{{ community.name }}</p>
                </div>
                <div class="card-content">
                    <div>
                        <button class="button is-warning" @click="handleCommunityAction('edit', '{{ community.id }}', 'stream')"><i class="fas fa-pen"></i></button>
                        <button class="button is-danger" @click="handleCommunityAction('delete', '{{ community.id }}', 'stream')"><i class="fas fa-trash"></i></button>
                        <button class="button is-link" {% if not community.url %}title="disabled" disabled{% endif %}><i class="fas fa-up-right-from-square"></i></button>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<div class="modal" x-show="isOpen" :class="{ 'is-active': isOpen }" x-cloak>
    <div class="modal-background" @click="closeModal()"></div>
    <div class="modal-card">
        <header class="modal-card-head">
            <p class="modal-card-title" x-text="modalTitle"></p>
            <button class="delete" aria-label="close" @click="closeModal()"></button>
        </header>
        <section class="modal-card-body" x-html="modalBodyContent" id="modal-body">
            <!-- Content will be dynamically injected here -->
        </section>
        <footer class="modal-card-foot">
            <button class="button is-success" @click="saveCallback()" x-text="modalActionButtonText"></button>
            <button class="button" @click="closeModal()">Cancel</button>
        </footer>
    </div>
</div>

{% endblock content %}
